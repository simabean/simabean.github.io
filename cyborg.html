<!DOCTYPE html>
<title>Cybrog</title>
<style>
 h1 { display: inline-block; margin: 0; }
 table td { border: 1px solid black; }
</style>

<h1>Cyborg</h1>
<select id="scenarios"></select>
<button name="generate">generate</button>
<table id="roles">
</table>
<div id="footer"></div>

<script src="lib/jquery.min.js"></script>
<script src="lib/revgram.js"></script>
<script src="cyborg.js"></script>
<script>
 var cyborgData = {};

 var getName = function(nameSet) {
     var name = undefined;
     var count = 20;

     while (!name && (count-- > 0)) {
         name = revgram.generate(cyborgData.names, 'start');
         if (name in nameSet)
             name = undefined;
         else nameSet[name] = true;
     }
     return name;
 };

 var setRoles = function(list) {
     var nameSet = {};
     $('#roles').empty();
     $('#roles').append('<tr><th>Name</th><th>Role</th></tr>');

     cyborg.createRoleList(cyborgData, list).forEach(function(entry) {
         $('#roles').append(
             '<tr><td>' + getName(nameSet) + '</td><td> ' +
             entry.faction + ' ' +  entry.role + '</tr>');
     });
 };

 jQuery(function($) {
     var scenarios = $('#scenarios');
     scenarios.on('change', function(event) {
         setRoles($(event.target).val());
     });
     $('button[name="generate"]').on('click', function(event) {
         setRoles(scenarios.val());
     });

     cyborg.start($, function(data) {
         cyborgData = data;
         scenarios.empty();
         Object.keys(data.scenarios).forEach(function(scenario) {
             scenarios.append(
                 '<option' + (scenario === data.scenarioDefault ?
                              ' selected="selected"' : '') + '>' +
                 scenario + '</option>');
         });

         setRoles(scenarios.val());
     });
 });
</script>
